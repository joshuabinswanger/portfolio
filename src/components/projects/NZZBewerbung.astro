---
import { CldImage } from "astro-cloudinary";
import { getCollection } from "astro:content";
const galleryImages = await getCollection("galleryImages");

// 1. FRONTMATTER: Fetch files and force Vite to return production-ready URLs
const n64Files = import.meta.glob(
  "/src/assets/projects/gamedesign101/N64_avif_sequence/*.avif",
  { eager: true, query: "?url" },
);
const flowerFiles = import.meta.glob(
  "/src/assets/projects/flower_splat/flower_splat_avif_sequence/*.avif",
  { eager: true, query: "?url" },
);

const n64Urls = Object.values(n64Files)
  .map((mod: any) => mod.default)
  .sort();
const flowerUrls = Object.values(flowerFiles)
  .map((mod: any) => mod.default)
  .sort()
  .reverse(); // Flips the array backwards
---

<div id="scrolly-container">
  <div id="panel-1" class="scrolly-panel split-panel">
    <div class="text-col">
      <h1 class="text-block text-p1" style="font-size: 36px;">Hi,</h1>
      <h1 class="text-block text-p1-1">mein Name ist Joshua Binswanger.</h1>
    </div>
    <div class="img-col">
      <div class="img-stack img-quercus">
        <CldImage
          src="QuercusRobur_VolumeRendering_epzxld"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Quercus Robur Volume Rendering"
        />
      </div>
      <div class="img-stack img-gjermundbu">
        <CldImage
          src="Gjermundbu_GalleryImages_1_sco2yz"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Gjermundbu Helmet"
        />
      </div>
      <div class="img-stack img-buchdrucker-1">
        <CldImage
          src="Buchdrucker_djaxkc"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Buchdrucker Käfer"
        />
      </div>
      <div class="img-stack img-eth-vis-3">
        <CldImage
          src="ETHVisualisations_Gallery_3_myrndw"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="ETH Visualisation 3"
        />
      </div>
    </div>
  </div>

  <div id="panel-2" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p2">
        Ich verleihe komplexen Zusammenhängen eine visuelle Form.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-eth-vis-1">
        <CldImage
          src="ETHVisualisations_GalleryPic1_hnzfw1"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="ETH Visualisation 1"
        />
      </div>
      <div class="img-stack img-pheno-zoom">
        <CldImage
          src="Phenological_Shift_GalleryImage1_cjmvqe"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Phenological Shift Zoom"
        />
      </div>
      <div class="img-stack img-pheno-base">
        <CldImage
          src="Phenological_Shift_GalleryImage_1_fkhkff"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Phenological Shift"
        />
      </div>
    </div>
  </div>

  <div id="panel-3" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p3">
        Dafür verbinde ich inhaltliche Tiefe mit ästhetischem Anspruch.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-wood-zoom">
        <CldImage
          src="StructureofWood_Gallery_5_g1x7ry"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Structure of Wood Zoom"
        />
      </div>
      <div class="img-stack img-wood-base">
        <CldImage
          src="StructureofWood_Gallery_12_rbvqux"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Structure of Wood"
        />
      </div>
    </div>
  </div>

  <div id="panel-4" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p4">
        Und breche komplexe Sachverhalte zielgruppengerecht herunter.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-microbiome">
        <CldImage
          src="Microbiome_OLMA_ttmkmz"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Microbiome OLMA"
        />
      </div>
      <div class="img-stack img-freedom-zoom">
        <CldImage
          src="Freedom_GalleryImages_5_pbxr8g"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Freedom Gallery Zoom"
        />
      </div>
      <div class="img-stack img-freedom-base">
        <CldImage
          src="Freedom_Infografik_z43mem"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Freedom Infographic"
        />
      </div>
    </div>
  </div>

  <div id="panel-5" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p5">
        Meine gestalterischen Grundlagen habe ich im BA Knowledge Visualization
        (ZHdK) erworben.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-yearring">
        <CldImage
          src="StructureofWood_YearRing_1_tvgnzr"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Year Ring"
        />
      </div>
      <div class="img-stack img-figure">
        <CldImage
          src="FigureDrawing_Gallery_23_dnrpi3"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Figure Drawing"
        />
      </div>
      <div class="img-stack img-misc-3d">
        <CldImage
          src="Misc_3D_GalleryImages_1_haojjs"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Misc 3D"
        />
      </div>
      <div class="img-stack img-illustration">
        <CldImage
          src="Illustration_GalleryImages_1_sihglc"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Illustration"
        />
      </div>
    </div>
  </div>

  <div id="panel-6" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p6">
        Nach dem Abschluss suchte ich als wissenschaftlicher Illustrator die
        Herausforderung, anspruchsvolle Inhalte schnell zu durchdringen und ihre
        essenziellen Aussagen zu destillieren.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-buchdrucker-poster">
        <CldImage
          src="Buchdrucker_Poster"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Buchdrucker Poster"
        />
      </div>
      <div class="img-stack img-eth-vis-2">
        <CldImage
          src="ETHVisualisations_GalleryPic2_mdr3sb"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="ETH Visualisation 2"
        />
      </div>
    </div>
  </div>

  <div id="panel-7" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p7">
        Meine Neugier leitet mich dazu an, mein technisches Repertoire stetig zu
        erweitern. Die Grundlage meiner Praxis bildet mein 3D-Wissen, das ich
        mir an der Vertex School angeeignet habe. Heute gebe ich dieses Wissen
        in Blender-Workshops weiter.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-blender-course">
        <CldImage
          src="UZHBlenderCourse_1_r6kaar"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Blender Course UZH"
        />
      </div>
    </div>
  </div>

  <div id="panel-8" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p8">
        Bei der Lernapp «Xylopedia» (basierend auf Mikro-CT-Daten) habe ich
        zudem gelernt, wie wichtig klare Strukturierung, UX-Design und
        Storytelling in der Wissensvermittlung sind.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-xylo-ipad">
        <CldImage
          src="Xylopedia_Ipad_topget"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Xylopedia iPad"
        />
      </div>
      <div class="img-stack img-eiche-vdb">
        <CldImage
          src="Eiche_HoudiniVDB_049_mpdcoj"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Eiche Houdini VDB"
        />
      </div>
      <div class="img-stack img-xylo-gallery">
        <CldImage
          src="Xylopedia_Gallery_4_t8h8zq"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Xylopedia Gallery"
        />
      </div>
    </div>
  </div>

  <div id="panel-9" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p9">
        Da heute visuelles Storytelling im Browser stattfindet, habe ich mich
        auch vertieft mit Web-Technologien auseinandergesetzt.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-portfolio-video">
        <CldImage
          src="Portfolio_lc2mft"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Portfolio Web Tech Video/GIF"
        />
      </div>
    </div>
  </div>

  <div id="panel-10" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p10">
        Dabei sind animierte Elemente besonders wichtig.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-n64-canvas">
        <canvas id="n64-canvas"></canvas>
      </div>
    </div>
  </div>

  <div id="panel-11" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p11">
        Seit einem Jahr verantworte ich beim Medizin-Start-up Augmedi komplexe
        3D-Scans und Web-Modelle. Dabei integriere ich neue Workflows
        (Scripting, ComfyUI) und erschliesse neue Formate wie Gaussian Splats.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-houdini-scripts">
        <CldImage
          src="Houdini_Scripts_hd7d5e"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Houdini Scripts"
        />
      </div>
      <div class="img-stack img-augmedi-approach">
        <CldImage
          src="Augmedi_Appraoch_tuka73"
          width="1200"
          sizes="(max-width: 768px) 100vw, 50vw"
          alt="Augmedi Approach"
        />
      </div>
    </div>
  </div>

  <div id="panel-12" class="scrolly-panel split-panel">
    <div class="text-col">
      <p class="text-block text-p12-1">
        Ich möchte nun mein technisches Skillset aus der Wissenschaft nutzen, um
        gesellschaftsrelevante Inhalte für ein breites Publikum visuell greifbar
        zu machen.
      </p>
      <p class="text-block text-p12-2">
        Die analytische Klarheit und visuelle Eleganz der NZZ Visuals
        beeindrucken mich schon lange.
      </p>
      <p class="text-block text-p12-3">
        Deswegen bewerbe ich mich für das Volontariat bei NZZ Visuals: Um von
        eurem Team zu lernen und gemeinsam neue digitale Formate zu prägen.
      </p>
    </div>
    <div class="img-col">
      <div class="img-stack img-flower-canvas">
        <canvas id="flower-canvas"></canvas>
      </div>
    </div>
  </div>
</div>

<div
  id="image-sequences"
  style="display: none;"
  data-n64={JSON.stringify(n64Urls)}
  data-flower={JSON.stringify(flowerUrls)}
>
</div>

<script>
  import Lenis from "lenis";
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import { CustomEase } from "gsap/CustomEase";
  import { SplitText } from "gsap/SplitText";

  gsap.registerPlugin(ScrollTrigger, CustomEase, SplitText);

  const lenis = new Lenis({ lerp: 0.1, wheelMultiplier: 1, smoothWheel: true });
  lenis.on("scroll", ScrollTrigger.update);
  gsap.ticker.add((time) => {
    lenis.raf(time * 1000);
  });

  const masterTl = gsap.timeline({
    scrollTrigger: {
      trigger: "#scrolly-container",
      start: "top top",
      end: "+=20000%",
      scrub: 1,
      pin: true,
      markers: false,
    },
  });

  const splitTexts = new SplitText(".text-block", {
    type: "words",
    wordsClass: "word",
  });

  // --- Extract Data from Island ---
  const dataIsland = document.getElementById("image-sequences");
  const n64Urls = JSON.parse(dataIsland.dataset.n64 || "[]");
  const flowerUrls = JSON.parse(dataIsland.dataset.flower || "[]");

  // --- N64 Canvas Setup (Panel 10) ---
  const n64Canvas = document.getElementById("n64-canvas") as HTMLCanvasElement;
  const n64Ctx = n64Canvas.getContext("2d");
  const n64Images = [];
  const n64Playhead = { frame: 0 };

  n64Urls.forEach((url) => {
    const img = new window.Image();
    img.src = url;
    n64Images.push(img);
  });

  if (n64Images.length > 0) {
    n64Images[0].onload = () => {
      n64Canvas.width = n64Images[0].naturalWidth;
      n64Canvas.height = n64Images[0].naturalHeight;
      renderN64();
    };
  }

  const renderN64 = () => {
    if (n64Images.length === 0) return;
    n64Ctx.clearRect(0, 0, n64Canvas.width, n64Canvas.height);
    const frame = Math.min(
      Math.max(Math.round(n64Playhead.frame), 0),
      n64Images.length - 1,
    );
    n64Ctx.drawImage(n64Images[frame], 0, 0, n64Canvas.width, n64Canvas.height);
  };

  // --- Flower Splat Canvas Setup (Panel 12) ---
  const flowerCanvas = document.getElementById(
    "flower-canvas",
  ) as HTMLCanvasElement;
  const flowerCtx = flowerCanvas.getContext("2d");
  const flowerImages = [];
  const flowerPlayhead = { frame: 0 };

  flowerUrls.forEach((url) => {
    const img = new window.Image();
    img.src = url;
    flowerImages.push(img);
  });

  if (flowerImages.length > 0) {
    flowerImages[0].onload = () => {
      flowerCanvas.width = flowerImages[0].naturalWidth;
      flowerCanvas.height = flowerImages[0].naturalHeight;
      renderFlower();
    };
  }

  const renderFlower = () => {
    if (flowerImages.length === 0) return;
    flowerCtx.clearRect(0, 0, flowerCanvas.width, flowerCanvas.height);
    const frame = Math.min(
      Math.max(Math.round(flowerPlayhead.frame), 0),
      flowerImages.length - 1,
    );
    flowerCtx.drawImage(
      flowerImages[frame],
      0,
      0,
      flowerCanvas.width,
      flowerCanvas.height,
    );
  };

  gsap.set(".text-block", { opacity: 1, y: 0 });
  gsap.set(splitTexts.words, { opacity: 0, y: 20 });

  // Helper functions
  const showText = (selector, sync = false) => {
    return masterTl.to(
      `${selector} .word`,
      { opacity: 1, y: 0, duration: 0.8, stagger: 0.04, ease: "power2.out" },
      sync ? "<" : "+=0.2",
    );
  };
  const hideText = (selector, sync = false) => {
    return masterTl.to(
      selector,
      { opacity: 0, y: -20, duration: 1 },
      sync ? "<" : "+=0.2",
    );
  };

  const showImg = (selector, sync = false) => {
    const imageTl = gsap.timeline();
    imageTl
      .to(selector, {
        y: "0%",
        duration: 1,
      })
      .to(
        selector,
        {
          opacity: 1,
          duration: 0.8,
        },
        ">-0.8",
      );
    return masterTl.add(imageTl, sync ? "<" : "-=0.2");
  };

  const zoomFadeInImg = (selector, sync = false) => {
    return masterTl.fromTo(
      selector,
      {
        y: "0%",
        opacity: 0,
        scale: 1.4,
      },
      {
        opacity: 1,
        duration: 1.2,
        scale: 1,
        ease: "power2.out",
      },
      sync ? "<" : "-=0.5",
    );
  };

  const hideImg = (selector, sync = false) => {
    return masterTl.to(
      selector,
      {
        y: "-100%",
        opacity: 0,
        duration: 1,
      },
      sync ? "<" : "+=0.2",
    );
  };

  const pause = (duration = 0.2) => {
    return masterTl.to({}, { duration: duration });
  };

  // ------------------------------------------
  // GSAP Timeline Sequencing
  // ------------------------------------------

  // Panel 1: Intro
  masterTl.set("#panel-1", { opacity: 1 });
  showText(".text-p1");
  showText(".text-p1-1", true); // Sync text
  pause(); // Added a pause here so the user can read the intro!

  hideText(".text-p1"); // Text leaves before new image comes
  hideText(".text-p1-1", true);
  showImg(".img-quercus", true);
  pause();

  hideImg(".img-quercus", true); // Hide old image (synced)
  showImg(".img-gjermundbu", true); // Show new image (synced)
  pause();

  hideImg(".img-gjermundbu", true);
  showImg(".img-buchdrucker-1", true);
  pause();

  hideImg(".img-buchdrucker-1", true);
  showImg(".img-eth-vis-3", true);
  pause();
  masterTl.to("#panel-1", { opacity: 0, duration: 0.5 });

  // Panel 2: Mission Statement
  masterTl.to("#panel-2", { opacity: 1, duration: 1 });
  showText(".text-p2", true);
  pause();

  hideText(".text-p2");
  showImg(".img-eth-vis-1", true);
  pause();

  hideImg(".img-eth-vis-1", true);
  zoomFadeInImg(".img-pheno-zoom", true);
  pause();

  hideImg(".img-pheno-zoom", true);
  showImg(".img-pheno-base", true);
  pause();
  masterTl.to("#panel-2", { opacity: 0, duration: 0.5 });

  // Panel 3: Ästhetik & Tiefe
  masterTl.to("#panel-3", { opacity: 1, duration: 1 });
  showText(".text-p3", true);
  pause();

  hideText(".text-p3");
  zoomFadeInImg(".img-wood-zoom", true);
  pause();

  hideImg(".img-wood-zoom", true);
  showImg(".img-wood-base", true);
  pause();
  masterTl.to("#panel-3", { opacity: 0, duration: 0.5 });

  // Panel 4: Zielgruppe
  masterTl.to("#panel-4", { opacity: 1, duration: 1 });
  showText(".text-p4", true);
  pause();

  hideText(".text-p4");
  showImg(".img-microbiome", true);
  pause();

  hideImg(".img-microbiome", true);
  zoomFadeInImg(".img-freedom-zoom", true);
  pause();

  hideImg(".img-freedom-zoom", true);
  showImg(".img-freedom-base", true);
  pause();
  masterTl.to("#panel-4", { opacity: 0, duration: 0.5 });

  // Panel 5: Die Basis
  masterTl.to("#panel-5", { opacity: 1, duration: 1 });
  showText(".text-p5", true);
  pause();

  hideText(".text-p5");
  showImg(".img-yearring", true);
  pause();

  hideImg(".img-yearring", true);
  showImg(".img-figure", true);
  pause();

  hideImg(".img-figure", true);
  showImg(".img-misc-3d", true);
  pause();

  hideImg(".img-misc-3d", true);
  showImg(".img-illustration", true);
  pause();
  masterTl.to("#panel-5", { opacity: 0, duration: 0.5 });

  // Panel 6: Der Start als Illustrator
  masterTl.to("#panel-6", { opacity: 1, duration: 1 });
  showText(".text-p6", true);
  pause();

  hideText(".text-p6");
  showImg(".img-buchdrucker-poster", true);
  pause();

  hideImg(".img-buchdrucker-poster", true);
  showImg(".img-eth-vis-2", true);
  pause();
  masterTl.to("#panel-6", { opacity: 0, duration: 0.5 });

  // Panel 7: 3D & Wissensvermittlung
  masterTl.to("#panel-7", { opacity: 1, duration: 1 });
  showText(".text-p7", true);
  pause();

  hideText(".text-p7");
  showImg(".img-blender-course", true);
  pause();
  masterTl.to("#panel-7", { opacity: 0, duration: 0.5 });

  // Panel 8: UX & Storytelling
  masterTl.to("#panel-8", { opacity: 1, duration: 1 });
  showText(".text-p8", true);
  pause();

  hideText(".text-p8");
  showImg(".img-xylo-ipad", true);
  pause();

  hideImg(".img-xylo-ipad", true);
  showImg(".img-eiche-vdb", true);
  pause();

  hideImg(".img-eiche-vdb", true);
  showImg(".img-xylo-gallery", true);
  pause();
  masterTl.to("#panel-8", { opacity: 0, duration: 0.5 });

  // Panel 9: Web Tech
  masterTl.to("#panel-9", { opacity: 1, duration: 1 });
  showText(".text-p9", true);
  pause();

  hideText(".text-p9");
  showImg(".img-portfolio-video", true);
  pause();
  masterTl.to("#panel-9", { opacity: 0, duration: 0.5 });

  // Panel 10: Animation & Interaktivität (N64 Canvas)
  masterTl.to("#panel-10", { opacity: 1, duration: 1 });
  showText(".text-p10", true);
  pause();

  hideText(".text-p10");
  showImg(".img-n64-canvas", true);
  masterTl.to(n64Playhead, {
    frame: (n64Images.length || 1) - 1,
    snap: "frame",
    ease: "none",
    onUpdate: renderN64,
    duration: 3,
  });
  pause();
  masterTl.to("#panel-10", { opacity: 0, duration: 0.5 });

  // Panel 11: Innovation & Current Role
  masterTl.to("#panel-11", { opacity: 1, duration: 1 });
  showText(".text-p11", true);
  pause();

  hideText(".text-p11");
  showImg(".img-houdini-scripts", true);
  pause();

  hideImg(".img-houdini-scripts", true);
  showImg(".img-augmedi-approach", true);
  pause();
  masterTl.to("#panel-11", { opacity: 0, duration: 0.5 });

  // Panel 12: Der Pitch (Flower Splat Canvas & Black bg transition)

  // 1. Transition background to black and text to white
  masterTl.to("#scrolly-container", {
    backgroundColor: "#000000",
    color: "#ffffff",
    duration: 1,
  });
  masterTl.to(".text-block", { color: "#ffffff", duration: 1 }, "<");

  masterTl.to(flowerPlayhead, {
    frame: (flowerImages.length || 1) - 1,
    snap: "frame",
    ease: "none",
    onUpdate: renderFlower,
    duration: 3,
  });

  masterTl.to("#panel-12", { opacity: 1, duration: 1 }, "<");
  showImg(".img-flower-canvas", true);

  showText(".text-p12-1", true);
  showText(".text-p12-2", true);
  showText(".text-p12-3", true);

  masterTl.to(flowerPlayhead, {
    frame: (flowerImages.length || 1) - 1,
    snap: "frame",
    ease: "none",
    onUpdate: renderFlower,
    duration: 3,
  });
</script>

<style>
  @import "../../styles/global.css";

  #scrolly-container {
    position: relative;
    width: 100%;
    height: 100svh;
    overflow: hidden;
    color: black;
    background-color: transparent; /* Changed to allow smooth GSAP animation */
    transition: background-color 0.5s ease;
  }

  .scrolly-panel {
    position: absolute;
    display: grid;
    width: 100%;
    height: 100svh;
    opacity: 0; /* Hidden by default */
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }

  .text-col {
    display: grid;
    grid-column: 1;
    grid-row: 1;
    width: 100%;
    height: 100svh;
    grid-auto-rows: min-content;
    align-content: center;
    padding-top: 30vh;
    background-color: transparent;
  }

  .img-col {
    grid-column: 1;
    grid-row: 1;
    width: 100%;
    align-items: end;
    height: 100svh;
    overflow: hidden;
    margin: 0 auto;
  }

  /* --- Image Stacking --- */

  .img-stack {
    position: absolute;
    inset: 0;
    opacity: 0;
    padding: 0 0 15vh 0;
    transform: translateY(100%);
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none; /* Allows clicking through hidden images */
  }

  .img-stack img {
    width: 100%; /* Take up full container width */
    height: auto; /* Maintain aspect ratio */
    max-width: 800px; /* Optional: cap the size so it doesn't get too huge */
    max-height: 85vh; /* Keep it within the viewport height */
    object-fit: scale-down !important;
  }

  #n64-canvas {
    width: 100%;
    height: auto;
    max-width: 800px;
    max-height: 60vh;
    object-fit: contain;
  }
  /* --- Typography --- */

  .text-container {
    max-width: 800px;
    text-align: left;
  }

  .text-block {
    opacity: 0;
    z-index: 2;
    transform: translateY(20px); /* Pre-set for animation */
    line-height: 1.5;
    color: black;
  }

  .center-panel .text-container {
    margin-bottom: 20vh;
  }

  .text-col .text-block {
    justify-self: center;
    width: 90%;
    padding: 5%;
    top: 0;
    left: 0;
    margin: 0;
  }

  .text-col .padding-top {
    padding-top: 65svh;
  }

  h1.text-block {
    font-size: 20px;
    font-weight: 700;
    line-height: 1.5;
    margin-bottom: 1.5rem;
  }

  h2.text-block {
    font-size: var(--font-size-mobile-h1);
    font-weight: 400;
  }

  p.text-block {
    font-size: var(--font-size-desktop);
  }

  /* --- custom layout --- */

  #panel-1 .text-col {
    align-content: start;
    padding-top: 15vh;
  }

  #panel-12 .text-col {
    align-content: start;
    padding-top: 15vh;
  }

  #panel-12 .text-col .text-block {
    background-color: transparent;
    color: var(--bg-color);
  }

  /* --- Links and Buttons --- */

  .inline-link {
    color: #1a1a1a;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 4px;
    transition: opacity 0.3s;
  }

  .inline-link:hover {
    opacity: 0.7;
  }

  .action-links {
    margin-top: 3rem;
    display: flex;
    gap: 1.5rem;
    justify-content: center;
  }

  .btn {
    display: inline-block;
    padding: 0.8rem 1.5rem;
    border: 1px solid #1a1a1a;
    border-radius: 4px;
    color: #1a1a1a;
    text-decoration: none;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all 0.3s ease;
  }

  /* Desktop Responsiveness */
  @media (min-width: 768px) {
    .split-panel {
      flex-direction: row;
      align-items: center;
      justify-content: center;
      padding: 0 5%;
      gap: 4rem;
    }

    .text-col {
      height: 50vh;
      width: 50%;
    }

    .text-col .text-block {
      top: 20%; /* Vertically balance text block on desktop */
    }

    .img-col {
      height: 100vh;
      width: 50%;
      display: flex;
      align-items: center;
      position: relative;
    }

    h1.text-block {
      font-size: 3rem;
    }
    h2.text-block {
      font-size: 2rem;
    }
    p.text-block {
      font-size: 1.25rem;
    }
  }
</style>
