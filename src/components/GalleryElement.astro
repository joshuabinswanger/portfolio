---
import SquareBracketH from "./SquareBracket_H.astro";
import "../styles/global.css";
import ImageElement from "./ImageElement.astro";
import ThumbnailElement from "./ThumbnailElement.astro";

interface Props {
    totalImages: number;
	title: string;
	subtitle: string;
};

const { totalImages, title, subtitle } = Astro.props;
const instanceId = Math.random().toString(36).substr(2, 9); // Generate a unique ID for each instance
---

<div class:list={["fade", "GalleryElementWrapper"]} id={`GalleryElement-${instanceId}`}>
	<div id="ImageWrapper">
	  {totalImages >= 1 && (
		<div id="ImageContainer">
		  <slot name="Image1" />
		</div>
	  )}
	  {totalImages >= 2 && (
		<div id="ImageContainer">
		  <slot name="Image2" />
		</div>
	  )}
	  {totalImages >= 3 && (
		<div id="ImageContainer">
		  <slot name="Image3" />
		</div>
	  )}
	  {totalImages >= 4 && (
		<div id="ImageContainer">
		  <slot name="Image4" />
		</div>
	  )}
	  {totalImages >= 5 && (
		<div id="ImageContainer">
		  <slot name="Image5" />
		</div>
	  )}
	</div>

	<div id="DescriptionWrapper">
		<SquareBracketH padding="3% 1%">
			<div id="TextContainer">
				<h1>{title}</h1>
				<h2>{subtitle}</h2>
			</div>
		</SquareBracketH>
		<SquareBracketH>
			<div id="ArrowWrapper">
				<div id="ArrowContainer">
					&larr;
				</div>
				<div id="CounterContainer">
					1 / {totalImages}
				</div>
		
				<div id="ArrowContainer">
					&rarr;
				</div>

			</div>
		</SquareBracketH>
	</div>
</div>

<script define:vars={{ totalImages, instanceId }}>
	(function() {
		const imageCount = totalImages;
		const instanceSelector = `#GalleryElement-${instanceId}`;

		document.addEventListener('astro:page-load', ev => {
			let currentIndex = 1;

			function updateImageVisibility() {
				document.querySelectorAll(`${instanceSelector} #ImageWrapper #ImageContainer`).forEach((div, index) => {
					div.style.opacity = (index + 1 === currentIndex) ? '1' : '0';
				});
			}

			function updateCounter() {
				const counterContainer = document.querySelector(`${instanceSelector} #CounterContainer`);
				counterContainer.textContent = `${currentIndex} / ${imageCount}`;
			}

			document.querySelector(`${instanceSelector} #ArrowWrapper div:nth-child(3)`).addEventListener('click', function() {
				currentIndex++;
				if (currentIndex > imageCount) currentIndex = 1;
				updateImageVisibility();
				updateCounter();
			});

			document.querySelector(`${instanceSelector} #ArrowWrapper div:nth-child(1)`).addEventListener('click', function() {
				currentIndex--;
				if (currentIndex < 1) currentIndex = imageCount;
				updateImageVisibility();
				updateCounter();
			});

			updateImageVisibility();
			updateCounter();
		});
	})();
</script>


<style>

@import "../styles/global.css";

.GalleryElementWrapper {
	display: grid;
	gap: 1%;
	height: fit-content;
}

/* Images Overlapping*/
#ImageWrapper {
	display: grid; /* Parent container needs to be relative */
	grid-template-columns: 1fr;
	grid-template-rows: 1fr;
	pointer-events: auto;
	height: fit-content;

}

#ImageWrapper > div {
	grid-column: 1;
	grid-row: 1;
	transition: opacity 1s cubic-bezier(0.33, 1, 0.68, 1);
}

#ImageWrapper > div:nth-of-type(1) {
  opacity: 1; /* First image should be visible */
}

#ImageWrapper > div:nth-of-type(2) {
opacity: 0;
}

#ImageWrapper > div:nth-of-type(3) {
opacity: 0;
}

#ImageWrapper > div:nth-of-type(4) {
opacity: 0;
}

#ImageWrapper > div:nth-of-type(5) {
opacity: 0;
}

#ImageContainer {
	height: fit-content;
	box-shadow: 0px 0px 44px #988f821b;
}

/* Thumbnails */ 

#DescriptionWrapper {
	display: grid; 
	width: 100%;
	height: fit-content;
	grid-template-columns: minmax(min-content, 3fr) 2fr;
	justify-content: center;
	align-content: center;

}




/* Thumbnail Elements */

#GalleryThumbnails {
	display: grid;
	grid-template-columns: repeat(4, 1fr);
	grid-auto-rows: auto;
	gap: 5%;
	filter: sepia(0.5) grayscale(0.5);
	justify-content: center;
	opacity: 0.75;
}

#Thumbnail {
	pointer-events: auto;
}

/* Arrows */

#ArrowWrapper {
	display: grid;
	width: 100%;
	grid-template-columns: auto min-content auto;
	place-items: center;
	
}

#ArrowContainer {
	justify-content: center;
	text-align: center;
	width: stretch;
	pointer-events: auto;
	cursor: pointer;
	padding:0.5rem 0.5%;

}

#CounterContainer {
	text-align: center;
	width: 5ch;
	font-size: 1rem;
	padding:0.5rem 0.5%;
	@media (--bp-mobile) {
		font-size: 0.8rem;
	}

	@media (--bp-tablet) {
		font-size: 1rem;
	}
}

/* Thumbnail Text */

#TextContainer {
	width: fit-content;
}

h1 {
	font-family: PowerGrotesk-Medium;
	font-weight: 600;
	font-style: normal;
	font-size: 1rem;
	letter-spacing: 0.7px;
	margin: 0px;

	@media (--bp-mobile) {
		font-size: 0.8rem;
	}

	@media (--bp-tablet) {
		font-size: 1rem;
	}

}

h2 {
	font-family: PowerGrotesk-Light;
	font-weight: 200;
	font-style: italic;
	font-size: 0.8rem;
	letter-spacing: 0.5px;
	margin: 0px;
	margin-top: 4px;
	

	@media (--bp-mobile) {
		font-size: 0.6rem;
		margin-top: 0px;
	}

	@media (--bp-tablet) {
		font-size: 0.8rem;
		margin-top: 0px;
	}

}

h3 {
	font-family: PowerGrotesk-Light;
	font-weight: 200;
	font-style: normal;
	font-size: 0.8rem;
	text-align: end;
	letter-spacing: 0.5px;
	margin: 0px;


	@media (--bp-mobile) {
		font-size: 0.6rem;
	}

	@media (--bp-tablet) {
		font-size: 0.6rem;
	}

}
</style>